<!DOCTYPE html>
<html lang="en-ZA">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>See U | Premium Dating</title>
    
    <!-- Yoco SDK -->
    <script src="https://js.yoco.com/sdk/v1/yoco-sdk-web.js"></script>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Montserrat:wght@800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #FF3366;
            --primary-dark: #E62E5C;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            --dark: #0F172A;
            --dark-light: #1E293B;
            --light: #F8FAFC;
            --gray-400: #9CA3AF;
            --radius: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--dark); 
            color: var(--light); 
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Loading Screen */
        #loadingScreen {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: var(--dark); 
            display: flex; 
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        .loading-logo { 
            font-size: 5rem; 
            color: var(--primary); 
            margin-bottom: 1.5rem; 
            animation: heartbeat 1.4s infinite; 
        }
        .loading-text { 
            font-family: 'Montserrat'; 
            font-size: 3rem; 
            font-weight: 900; 
            color: var(--primary); 
        }
        @keyframes heartbeat { 
            0% { transform: scale(1); } 
            14% { transform: scale(1.3); } 
            28% { transform: scale(1); } 
            42% { transform: scale(1.3); } 
            70% { transform: scale(1); } 
        }

        /* Screens */
        .screen {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: var(--dark); 
            display: none; 
            flex-direction: column;
            overflow-y: auto;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .screen.active { 
            display: flex; 
            opacity: 1;
        }

        /* Header */
        .app-header {
            padding: 1rem 1.5rem; 
            background: rgba(30, 41, 59, 0.95);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-title {
            font-size: 1.5rem; 
            font-weight: 700; 
            color: var(--primary);
        }
        .back-btn {
            background: none; 
            border: none; 
            color: var(--gray-400);
            font-size: 1.2rem; 
            cursor: pointer; 
            margin-right: 1rem;
            transition: color 0.3s ease;
        }
        .back-btn:hover {
            color: var(--primary);
        }

        /* Logout Button */
        .logout-btn {
            background: rgba(255, 255, 255, 0.1); 
            border: none; 
            color: var(--gray-400);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .logout-btn:hover {
            background: rgba(255, 51, 102, 0.2);
            color: var(--primary);
            transform: scale(1.05);
        }

        /* Auth */
        .auth-container {
            flex: 1; 
            display: flex; 
            justify-content: center;
            align-items: center; 
            padding: 1.5rem;
            animation: fadeIn 0.5s ease;
        }
        .auth-card {
            background: var(--dark-light); 
            border-radius: var(--radius);
            padding: 2.5rem; 
            width: 100%; 
            max-width: 420px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        .auth-title {
            font-size: 1.75rem; 
            margin-bottom: 1.5rem;
            text-align: center; 
            color: var(--light);
        }
        .form-group { 
            margin-bottom: 1.25rem; 
            position: relative;
        }
        .form-label { 
            display: block; 
            margin-bottom: 0.5rem; 
            color: var(--light); 
            font-weight: 500; 
        }
        .form-input {
            width: 100%; 
            padding: 0.875rem 1rem;
            background: rgba(255,255,255,0.05); 
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px; 
            color: var(--light); 
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .form-input:focus { 
            outline: none; 
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 51, 102, 0.1);
        }
        .form-input.error {
            border-color: var(--error);
        }
        .form-textarea {
            width: 100%; 
            padding: 0.875rem 1rem;
            background: rgba(255,255,255,0.05); 
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px; 
            color: var(--light); 
            font-size: 1rem;
            min-height: 100px; 
            resize: vertical; 
            font-family: 'Inter', sans-serif;
            transition: border-color 0.3s ease;
        }
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 51, 102, 0.1);
        }
        .error-message {
            color: var(--error);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }
        .error-message.show {
            display: block;
        }

        /* Password Strength */
        .password-strength {
            margin-top: 0.5rem;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
        }
        .strength-bar {
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 2px;
        }
        .strength-weak { background: var(--error); }
        .strength-medium { background: var(--warning); }
        .strength-strong { background: var(--success); }

        /* Buttons */
        .btn {
            display: inline-flex; 
            align-items: center; 
            justify-content: center;
            gap: 0.75rem; 
            padding: 0.875rem 1.5rem; 
            background: var(--primary);
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-size: 1rem;
            font-weight: 600; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 0.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .btn:hover { 
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 51, 102, 0.2);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn-secondary { 
            background: rgba(255,255,255,0.1); 
        }
        .btn-secondary:hover { 
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 255, 255, 0.1);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        .btn-loading {
            pointer-events: none;
        }
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Links */
        .auth-links { 
            text-align: center; 
            margin-top: 1.5rem; 
            color: var(--gray-400); 
        }
        .auth-link { 
            color: var(--primary); 
            cursor: pointer; 
            font-weight: 500; 
            margin-left: 0.5rem;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .auth-link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        /* Terms & Conditions */
        .terms {
            margin-top: 1rem;
            text-align: center;
            color: var(--gray-400);
            font-size: 0.875rem;
        }
        .terms-link {
            color: var(--primary);
            text-decoration: none;
            cursor: pointer;
        }
        .terms-link:hover {
            text-decoration: underline;
        }

        /* Payment */
        .payment-amount { 
            font-size: 3rem; 
            font-weight: 900; 
            color: var(--primary); 
            text-align: center; 
            margin: 1rem 0; 
        }
        .benefits-list { 
            background: rgba(255,255,255,0.03); 
            border-radius: 8px; 
            padding: 1.5rem; 
            margin: 1.5rem 0; 
        }
        .benefit-item { 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
            margin-bottom: 0.75rem; 
            color: var(--gray-400); 
        }
        .benefit-item i { color: var(--success); }

        /* Yoco Card Form */
        .yoco-card-form {
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .card-element {
            padding: 0.875rem 1rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            min-height: 50px;
            display: flex;
            align-items: center;
        }
        .card-element.error {
            border-color: var(--error);
        }

        /* Secure Payment Notice */
        .secure-payment-notice {
            background: rgba(16, 185, 129, 0.1);
            border-radius: 8px;
            padding: 1.25rem;
            margin: 1.5rem 0;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        .secure-payment-notice .header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--success);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .secure-payment-notice p {
            color: var(--gray-400);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Payment Success */
        .payment-success {
            text-align: center;
        }
        .success-icon {
            font-size: 5rem;
            color: var(--success);
            margin-bottom: 1.5rem;
        }
        .success-title {
            font-size: 2rem;
            color: var(--light);
            margin-bottom: 1rem;
        }
        .success-message {
            color: var(--gray-400);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        /* PROFILE PAGE */
        .profile-container {
            flex: 1; 
            padding: 1.5rem; 
            overflow-y: auto;
            animation: slideUp 0.4s ease;
        }
        .profile-header {
            display: flex; 
            align-items: center; 
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(255,255,255,0.02);
            border-radius: var(--radius);
        }
        .profile-avatar {
            width: 120px; 
            height: 120px; 
            border-radius: 50%;
            background: var(--primary); 
            display: flex;
            align-items: center; 
            justify-content: center;
            font-size: 2.5rem; 
            color: white;
            border: 3px solid var(--primary);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .profile-avatar:hover {
            transform: scale(1.05);
        }
        .profile-avatar img {
            width: 100%; 
            height: 100%; 
            border-radius: 50%;
            object-fit: cover;
        }
        .profile-info h2 {
            font-size: 1.75rem; 
            color: var(--light); 
            margin-bottom: 0.25rem;
        }
        .profile-info p {
            color: var(--gray-400); 
            margin-bottom: 0.5rem;
        }
        .premium-badge {
            display: inline-flex; 
            align-items: center; 
            gap: 0.5rem;
            background: rgba(16, 185, 129, 0.15); 
            color: var(--success);
            padding: 0.5rem 1rem; 
            border-radius: 50px; 
            font-weight: 600; 
            margin-top: 0.5rem;
            animation: pulse 2s infinite;
        }
        .edit-profile-btn {
            background: rgba(255,255,255,0.1); 
            color: var(--light);
            border: none; 
            padding: 0.75rem 1.5rem; 
            border-radius: 6px;
            cursor: pointer; 
            font-size: 0.9rem; 
            margin-top: 0.5rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .edit-profile-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        /* Media Grid */
        .media-section {
            margin-bottom: 2rem;
        }
        .section-title {
            font-size: 1.25rem; 
            color: var(--light); 
            margin-bottom: 1rem;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        .add-media-btn {
            background: var(--primary); 
            color: white; 
            border: none;
            padding: 0.75rem 1.5rem; 
            border-radius: 6px; 
            cursor: pointer;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }
        .add-media-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        .media-grid {
            display: grid; 
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        @media (min-width: 768px) {
            .media-grid { 
                grid-template-columns: repeat(4, 1fr); 
            }
        }
        .media-item {
            aspect-ratio: 1; 
            border-radius: var(--radius);
            background: var(--dark-light); 
            border: 2px solid transparent;
            display: flex; 
            flex-direction: column; 
            align-items: center;
            justify-content: center; 
            color: var(--gray-400); 
            cursor: pointer;
            overflow: hidden; 
            position: relative;
            transition: all 0.3s ease;
        }
        .media-item:hover { 
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        .media-item i { 
            font-size: 2rem; 
            margin-bottom: 0.5rem; 
}
        .media-item img, .media-item video {
            width: 100%; 
            height: 100%; 
            object-fit: cover;
        }
        .media-item .remove-btn {
            position: absolute; 
            top: 0.5rem; 
            right: 0.5rem;
            background: rgba(0,0,0,0.7); 
            color: white; 
            border: none;
            width: 28px; 
            height: 28px; 
            border-radius: 50%;
            cursor: pointer; 
            display: none;
            transition: all 0.3s ease;
        }
        .media-item:hover .remove-btn { 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .remove-btn:hover {
            background: var(--error);
            transform: scale(1.1);
        }

        /* Business/Service Feature */
        .business-section {
            background: var(--dark-light); 
            border-radius: var(--radius);
            padding: 1.5rem; 
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 51, 102, 0.2);
            animation: fadeIn 0.5s ease;
        }
        .business-toggle {
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        .toggle-switch {
            position: relative; 
            display: inline-block;
            width: 60px; 
            height: 30px;
        }
        .toggle-switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
}
        .toggle-slider {
            position: absolute; 
            cursor: pointer;
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0;
            background-color: #ccc; 
            transition: .4s; 
            border-radius: 30px;
        }
        .toggle-slider:before {
            position: absolute; 
            content: "";
            height: 22px; 
            width: 22px; 
            left: 4px; 
            bottom: 4px;
            background-color: white; 
            transition: .4s; 
            border-radius: 50%;
        }
        input:checked + .toggle-slider { 
            background-color: var(--success); 
        }
        input:checked + .toggle-slider:before { 
            transform: translateX(30px); 
        }
        .business-form { 
            display: none; 
            animation: slideDown 0.3s ease;
        }
        .business-form.active { 
            display: block; 
        }

        /* Business Card for other users to see */
        .business-card {
            background: linear-gradient(135deg, rgba(255, 51, 102, 0.1), rgba(16, 185, 129, 0.1));
            border-radius: var(--radius);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 1px solid rgba(255, 51, 102, 0.3);
            position: relative;
            animation: fadeIn 0.5s ease;
        }
        .business-card::before {
            content: "ðŸ’¼ Business/Service";
            position: absolute;
            top: -10px;
            left: 1rem;
            background: var(--dark);
            padding: 0 0.5rem;
            font-size: 0.8rem;
            color: var(--primary);
            font-weight: 600;
        }
        .business-card h4 {
            color: var(--light);
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        .business-card p {
            color: var(--gray-400);
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }
        .business-contact {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary);
            font-weight: 500;
            margin-top: 1rem;
        }

        /* DISCOVER PAGE */
        .discover-container {
            flex: 1; 
            padding: 1.5rem; 
            overflow-y: auto;
            animation: slideUp 0.4s ease;
        }
        .user-card {
            background: var(--dark-light); 
            border-radius: var(--radius);
            margin-bottom: 1.5rem; 
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            animation: fadeIn 0.5s ease;
            transition: transform 0.3s ease;
        }
        .user-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        .user-photos {
            position: relative; 
            height: 400px; 
            overflow: hidden;
        }
        .user-photo {
            width: 100%; 
            height: 100%; 
            object-fit: cover;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        .user-photo.active { 
            display: block; 
        }
        .photo-nav {
            position: absolute; 
            top: 0; 
            width: 100%; 
            height: 100%;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            padding: 20px; 
            pointer-events: none;
        }
        .nav-btn {
            background: rgba(0,0,0,0.5); 
            width: 40px; 
            height: 40px;
            border-radius: 50%; 
            display: flex; 
            align-items: center;
            justify-content: center; 
            color: white; 
            cursor: pointer;
            pointer-events: all; 
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }
        .nav-btn:hover {
            background: rgba(0,0,0,0.7);
            transform: scale(1.1);
        }
        .photo-dots {
            position: absolute; 
            bottom: 20px; 
            left: 0; 
            right: 0;
            display: flex; 
            justify-content: center; 
            gap: 8px;
        }
        .dot {
            width: 8px; 
            height: 8px; 
            border-radius: 50%;
            background: rgba(255,255,255,0.5); 
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .dot.active { 
            background: white;
            transform: scale(1.2);
        }
        .user-info {
            padding: 1.5rem;
        }
        .user-name {
            font-size: 1.5rem; 
            font-weight: 700; 
            color: var(--light);
            margin-bottom: 0.25rem;
        }
        .user-age {
            color: var(--gray-400); 
            margin-bottom: 0.5rem;
        }
        .user-bio {
            margin: 1rem 0; 
            line-height: 1.5; 
            color: var(--light);
        }
        .interests {
            display: flex; 
            flex-wrap: wrap; 
            gap: 8px; 
            margin: 1rem 0;
        }
        .interest-tag {
            background: rgba(255,51,102,0.15); 
            color: var(--primary);
            padding: 0.375rem 0.75rem; 
            border-radius: 20px;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }
        .interest-tag:hover {
            background: rgba(255,51,102,0.25);
            transform: translateY(-2px);
        }
        .video-player {
            width: 100%; 
            border-radius: 8px; 
            overflow: hidden;
            margin: 1rem 0;
        }
        .video-player video {
            width: 100%; 
            border-radius: 8px;
        }
        .action-buttons {
            display: flex; 
            gap: 0.75rem; 
            margin-top: 1.5rem;
        }
        .action-buttons .btn {
            flex: 1; 
            margin: 0;
        }
        .like-btn { 
            background: var(--success); 
        }
        .like-btn:hover {
            background: #0da271;
        }
        .whatsapp-btn { 
            background: #25D366; 
        }
        .whatsapp-btn:hover {
            background: #1da851;
        }

        /* MATCHES PAGE */
        .matches-container {
            flex: 1; 
            padding: 1.5rem; 
            overflow-y: auto;
            animation: slideUp 0.4s ease;
        }
        .matches-grid {
            display: grid; 
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        @media (min-width: 768px) {
            .matches-grid { 
                grid-template-columns: repeat(3, 1fr); 
            }
        }
        .match-card {
            background: var(--dark-light); 
            border-radius: var(--radius);
            padding: 1.5rem; 
            text-align: center; 
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease;
        }
        .match-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: 0 10px 20px rgba(255, 51, 102, 0.1);
        }
        .match-photo {
            width: 80px; 
            height: 80px; 
            border-radius: 50%;
            object-fit: cover; 
            margin: 0 auto 0.75rem;
            border: 3px solid var(--primary);
        }

        /* Dashboard Navigation */
        .dashboard-nav {
            display: flex; 
            background: var(--dark-light); 
            border-radius: var(--radius);
            padding: 0.5rem; 
            margin: 1rem 1.5rem;
            position: sticky;
            top: 70px;
            z-index: 99;
            backdrop-filter: blur(10px);
        }
        .nav-btn {
            flex: 1; 
            padding: 1rem; 
            text-align: center;
            background: transparent; 
            border: none; 
            color: var(--gray-400);
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 500;
            display: flex; 
            flex-direction: column; 
            align-items: center;
            gap: 0.5rem; 
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        .nav-btn i { 
            font-size: 1.5rem; 
        }
        .nav-btn.active {
            background: rgba(255, 51, 102, 0.2);
            color: var(--primary);
            box-shadow: inset 0 0 0 1px rgba(255, 51, 102, 0.3);
        }
        .nav-btn:hover:not(.active) {
            background: rgba(255,255,255,0.05);
            transform: translateY(-2px);
        }

        /* Settings Page Specific */
        .settings-section {
            background: var(--dark-light);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .settings-section h3 {
            color: var(--light);
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0,0,0,0.85); 
            display: none; 
            align-items: center;
            justify-content: center; 
            z-index: 2000; 
            padding: 1rem;
            animation: fadeIn 0.3s ease;
        }
        .modal-overlay.active { 
            display: flex; 
        }
        .modal-content {
            background: var(--dark-light); 
            border-radius: var(--radius);
            padding: 2rem; 
            max-width: 500px; 
            width: 100%;
            border: 1px solid rgba(255,255,255,0.15); 
            text-align: center;
            max-height: 90vh; 
            overflow-y: auto;
            animation: modalSlideUp 0.4s ease;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            display: flex; 
            justify-content: space-between;
            align-items: center; 
            margin-bottom: 1.5rem;
        }
        .modal-title {
            font-size: 1.5rem; 
            color: var(--light);
        }
        .close-modal {
            background: none; 
            border: none; 
            color: var(--gray-400);
            font-size: 1.5rem; 
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .close-modal:hover {
            color: var(--primary);
        }
        .match-heart { 
            font-size: 4rem; 
            color: var(--success); 
            margin-bottom: 1rem; 
            animation: heartbeat 1.4s infinite;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--dark-light);
            color: var(--light);
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            border-left: 4px solid var(--primary);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            transform: translateX(150%);
            transition: transform 0.4s ease;
            z-index: 3000;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.success {
            border-left-color: var(--success);
        }
        .toast.error {
            border-left-color: var(--error);
        }
        .toast.warning {
            border-left-color: var(--warning);
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 3rem 1.5rem;
            color: var(--gray-400);
        }
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary);
            opacity: 0.5;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes slideDown {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes modalSlideUp {
            from { 
                opacity: 0;
                transform: translateY(40px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .auth-card { padding: 1.5rem; }
            .profile-avatar { width: 100px; height: 100px; }
            .user-photos { height: 300px; }
            .nav-btn span { display: none; }
            .nav-btn i { font-size: 1.25rem; }
            .matches-grid { grid-template-columns: 1fr; }
            .media-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loading-logo"><i class="fas fa-heart"></i></div>
        <div class="loading-text">See U</div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer"></div>

    <!-- Sign In Page -->
    <div id="signinScreen" class="screen">
        <div class="app-header">
            <div class="header-title">See U</div>
        </div>
        <div class="auth-container">
            <div class="auth-card">
                <h2 class="auth-title">Welcome Back</h2>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="Enter your email" required>
                    <div class="error-message" id="loginEmailError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password" required>
                    <div class="error-message" id="loginPasswordError"></div>
                </div>
                <button class="btn" id="loginBtn" onclick="signIn()">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>
                
                <div class="auth-links">
                    New here? <span class="auth-link" onclick="showScreen('signupScreen')">Sign Up</span>
                </div>
                
                <div class="terms">
                    By continuing, you agree to our <a href="#" class="terms-link" onclick="showTermsModal()">Terms & Conditions</a> and <a href="#" class="terms-link" onclick="showPrivacyModal()">Privacy Policy</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign Up Page -->
    <div id="signupScreen" class="screen">
        <div class="app-header">
            <button class="back-btn" onclick="showScreen('signinScreen')"><i class="fas fa-arrow-left"></i></button>
            <div class="header-title">Join See U</div>
        </div>
        <div class="auth-container">
            <div class="auth-card">
                <h2 class="auth-title">Create Account</h2>
                
                <!-- Age Verification -->
                <div class="secure-payment-notice" style="margin-bottom: 1.5rem;">
                    <div class="header">
                        <i class="fas fa-exclamation-circle"></i>
                        <span>Age Restriction</span>
                    </div>
                    <p>You must be 18 years or older to use See U. By signing up, you confirm you are 18+.</p>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="signupName" placeholder="Your full name" required>
                    <div class="error-message" id="signupNameError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="signupEmail" placeholder="your@email.com" required>
                    <div class="error-message" id="signupEmailError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">WhatsApp Number</label>
                    <input type="tel" class="form-input" id="signupPhone" placeholder="+27 12 345 6789" required>
                    <div class="error-message" id="signupPhoneError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="signupPassword" placeholder="At least 8 characters" required oninput="checkPasswordStrength()">
                    <div class="password-strength">
                        <div class="strength-bar" id="passwordStrength"></div>
                    </div>
                    <div class="error-message" id="signupPasswordError"></div>
                </div>
                
                <!-- Terms Agreement -->
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label style="display: flex; align-items: flex-start; gap: 0.5rem; cursor: pointer; color: var(--light); font-size: 0.9rem;">
                        <input type="checkbox" id="termsAgreement" style="margin-top: 0.25rem;">
                        <span>
                            I agree to the <a href="#" class="terms-link" onclick="showTermsModal()">Terms & Conditions</a> and 
                            <a href="#" class="terms-link" onclick="showPrivacyModal()">Privacy Policy</a>. 
                            I confirm that I am 18 years or older and understand that payment is required to use this service.
                        </span>
                    </label>
                    <div class="error-message" id="termsError"></div>
                </div>
                
                <button class="btn" id="signupBtn" onclick="signUp()">
                    <i class="fas fa-arrow-right"></i> Continue to Payment (R289.99)
                </button>
                <div class="auth-links">
                    Have an account? <span class="auth-link" onclick="showScreen('signinScreen')">Sign In</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Yoco Payment Page -->
    <div id="yocoPaymentScreen" class="screen">
        <div class="app-header">
            <button class="back-btn" onclick="goBackFromPayment()"><i class="fas fa-arrow-left"></i></button>
            <div class="header-title">Complete Payment</div>
        </div>
        <div class="auth-container">
            <div class="auth-card">
                <h2 class="auth-title">Premium Access</h2>
                <p style="text-align: center; color: var(--gray-400); margin-bottom: 0.5rem;">Annual Subscription</p>
                <div class="payment-amount">R289.99</div>
                
                <div class="benefits-list">
                    <div class="benefit-item"><i class="fas fa-check-circle"></i> WhatsApp number sharing</div>
                    <div class="benefit-item"><i class="fas fa-check-circle"></i> Unlimited matches</div>
                    <div class="benefit-item"><i class="fas fa-check-circle"></i> Priority visibility</div>
                    <div class="benefit-item"><i class="fas fa-check-circle"></i> Verified profile badge</div>
                    <div class="benefit-item"><i class="fas fa-check-circle"></i> 8 Photos + 90-Second Video</div>
                    <div class="benefit-item"><i class="fas fa-check-circle"></i> Business/Service Feature</div>
                </div>
                
                <!-- Yoco Card Form -->
                <div class="yoco-card-form">
                    <div class="form-group">
                        <label class="form-label">Cardholder Name</label>
                        <input type="text" class="form-input" id="cardName" placeholder="Name on card" required>
                        <div class="error-message" id="cardNameError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Card Details</label>
                        <div id="yoco-card-element" class="card-element"></div>
                        <div class="error-message" id="cardError"></div>
                    </div>
                </div>
                
                <!-- Secure Payment Notice -->
                <div class="secure-payment-notice">
                    <div class="header">
                        <i class="fas fa-lock"></i>
                        <span>Secure Payment</span>
                    </div>
                    <p>
                        Your payment is encrypted and secure. We use Yoco for PCI-compliant payment processing.
                        Your card details are never stored on our servers.
                    </p>
                </div>
                
                <!-- Payment Button -->
                <button class="btn" id="yocoPaymentBtn" onclick="processYocoPayment()">
                    <i class="fas fa-lock"></i> Pay R289.99 Now
                </button>
                
                <div class="terms" style="margin-top: 1.5rem;">
                    By completing payment, you authorize us to charge R289.99 to your card for annual subscription.
                    Auto-renewal can be cancelled anytime. No refunds for used periods.
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Success Screen -->
    <div id="paymentSuccessScreen" class="screen">
        <div class="app-header">
            <div class="header-title">Welcome to See U</div>
        </div>
        <div class="auth-container">
            <div class="auth-card">
                <div class="payment-success">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2 class="success-title">Payment Successful! ðŸŽ‰</h2>
                    <p class="success-message">
                        Welcome to See U Premium! Your account has been activated and you now have full access to all features.
                    </p>
                    
                    <div class="benefits-list">
                        <div class="benefit-item"><i class="fas fa-check-circle"></i> Complete your profile</div>
                        <div class="benefit-item"><i class="fas fa-check-circle"></i> Upload photos & video</div>
                        <div class="benefit-item"><i class="fas fa-check-circle"></i> Start discovering matches</div>
                        <div class="benefit-item"><i class="fas fa-check-circle"></i> Use Business/Service feature</div>
                    </div>
                    
                    <button class="btn" onclick="completeOnboarding()" style="margin-top: 2rem;">
                        <i class="fas fa-rocket"></i> Launch Your Profile
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Setup Page -->
    <div id="profileSetupScreen" class="screen">
        <div class="app-header">
            <div class="header-title">Complete Your Profile</div>
        </div>
        <div class="auth-container">
            <div class="auth-card">
                <h2 class="auth-title">Tell Us About Yourself</h2>
                <p style="text-align: center; color: var(--gray-400); margin-bottom: 2rem;">
                    Complete your profile to start matching with amazing people
                </p>
                
                <div class="form-group">
                    <label class="form-label">Bio</label>
                    <textarea class="form-textarea" id="setupBio" placeholder="Tell others about yourself (e.g., interests, personality, what you're looking for)" maxlength="500"></textarea>
                    <div style="text-align: right; color: var(--gray-400); font-size: 0.875rem; margin-top: 0.25rem;">
                        <span id="setupBioCharCount">500</span> characters remaining
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Age</label>
                    <input type="number" class="form-input" id="setupAge" placeholder="Your age" min="18" max="100">
                    <div class="error-message" id="setupAgeError"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-input" id="setupLocation" placeholder="Your city or town">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Interests (comma separated)</label>
                    <input type="text" class="form-input" id="setupInterests" placeholder="e.g., hiking, music, travel, food, movies">
                </div>
                
                <button class="btn" id="completeSetupBtn" onclick="completeProfileSetup()">
                    <i class="fas fa-check"></i> Complete Setup & Continue
                </button>
                
                <button class="btn btn-secondary" onclick="skipProfileSetup()" style="margin-top: 1rem;">
                    <i class="fas fa-forward"></i> Skip for Now
                </button>
            </div>
        </div>
    </div>

    <!-- DASHBOARD PAGES -->

    <!-- Profile Page -->
    <div id="profilePage" class="screen">
        <div class="app-header">
            <div class="header-title">My Profile</div>
            <button class="logout-btn" onclick="logout()" title="Logout">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
        
        <!-- Navigation -->
        <div class="dashboard-nav">
            <button class="nav-btn active" onclick="showScreen('profilePage')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </button>
            <button class="nav-btn" onclick="showScreen('discoverPage')">
                <i class="fas fa-search"></i>
                <span>Discover</span>
            </button>
            <button class="nav-btn" onclick="showScreen('matchesPage')">
                <i class="fas fa-heart"></i>
                <span>Matches</span>
            </button>
            <button class="nav-btn" onclick="showScreen('settingsPage')">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </button>
        </div>
        
        <!-- Profile Content -->
        <div class="profile-container" id="profileContent">
            <!-- Profile content loaded dynamically -->
        </div>
    </div>

    <!-- Discover Page -->
    <div id="discoverPage" class="screen">
        <div class="app-header">
            <div class="header-title">Discover</div>
            <button class="logout-btn" onclick="logout()" title="Logout">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
        
        <!-- Navigation -->
        <div class="dashboard-nav">
            <button class="nav-btn" onclick="showScreen('profilePage')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </button>
            <button class="nav-btn active" onclick="showScreen('discoverPage')">
                <i class="fas fa-search"></i>
                <span>Discover</span>
            </button>
            <button class="nav-btn" onclick="showScreen('matchesPage')">
                <i class="fas fa-heart"></i>
                <span>Matches</span>
            </button>
            <button class="nav-btn" onclick="showScreen('settingsPage')">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </button>
        </div>
        
        <!-- Discover Content -->
        <div class="discover-container" id="discoverContent">
            <!-- User cards loaded dynamically -->
        </div>
    </div>

    <!-- Matches Page -->
    <div id="matchesPage" class="screen">
        <div class="app-header">
            <div class="header-title">My Matches</div>
            <button class="logout-btn" onclick="logout()" title="Logout">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
        
        <!-- Navigation -->
        <div class="dashboard-nav">
            <button class="nav-btn" onclick="showScreen('profilePage')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </button>
            <button class="nav-btn" onclick="showScreen('discoverPage')">
                <i class="fas fa-search"></i>
                <span>Discover</span>
            </button>
            <button class="nav-btn active" onclick="showScreen('matchesPage')">
                <i class="fas fa-heart"></i>
                <span>Matches</span>
            </button>
            <button class="nav-btn" onclick="showScreen('settingsPage')">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </button>
        </div>
        
        <!-- Matches Content -->
        <div class="matches-container">
            <div class="matches-grid" id="matchesList">
                <!-- Matches loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Settings Page -->
    <div id="settingsPage" class="screen">
        <div class="app-header">
            <div class="header-title">Settings</div>
            <button class="logout-btn" onclick="logout()" title="Logout">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
        
        <!-- Navigation -->
        <div class="dashboard-nav">
            <button class="nav-btn" onclick="showScreen('profilePage')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </button>
            <button class="nav-btn" onclick="showScreen('discoverPage')">
                <i class="fas fa-search"></i>
                <span>Discover</span>
            </button>
            <button class="nav-btn" onclick="showScreen('matchesPage')">
                <i class="fas fa-heart"></i>
                <span>Matches</span>
            </button>
            <button class="nav-btn active" onclick="showScreen('settingsPage')">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </button>
        </div>
        
        <!-- Settings Content -->
        <div class="profile-container">
            <div class="business-section">
                <h3 style="color: var(--light); margin-bottom: 1.5rem;">Account Settings</h3>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="settingsEmail" value="" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" id="settingsPhone" value="" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Subscription Status</label>
                    <div class="premium-badge" style="display: inline-flex; margin-top: 0.5rem;">
                        <i class="fas fa-crown"></i> Premium Member
                    </div>
                    <p style="color: var(--gray-400); font-size: 0.875rem; margin-top: 0.5rem;">
                        Next renewal: <span id="subscriptionRenewal"></span>
                    </p>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Change Password</label>
                    <button class="btn btn-secondary" onclick="changePassword()" style="width: auto; margin-top: 0.5rem;">
                        <i class="fas fa-key"></i> Change Password
                    </button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Data & Privacy</label>
                    <button class="btn btn-secondary" onclick="showPrivacyModal()" style="width: auto; margin-top: 0.5rem;">
                        <i class="fas fa-shield-alt"></i> View Privacy Policy
                    </button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Terms</label>
                    <button class="btn btn-secondary" onclick="showTermsModal()" style="width: auto; margin-top: 0.5rem;">
                        <i class="fas fa-file-contract"></i> View Terms & Conditions
                    </button>
                </div>
                
                <div class="form-group" style="margin-top: 2rem;">
                    <button class="btn" onclick="logout()" style="background: var(--error);">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Profile</h3>
                <button class="close-modal" onclick="closeModal('editProfileModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-input" id="editName">
                <div class="error-message" id="editNameError"></div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Bio</label>
                <textarea class="form-textarea" id="editBio" placeholder="Tell others about yourself" maxlength="500"></textarea>
                <div style="text-align: right; color: var(--gray-400); font-size: 0.875rem; margin-top: 0.25rem;">
                    <span id="bioCharCount">500</span> characters remaining
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Age</label>
                <input type="number" class="form-input" id="editAge" min="18" max="100">
                <div class="error-message" id="editAgeError"></div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Location</label>
                <input type="text" class="form-input" id="editLocation" placeholder="Your city">
            </div>
            
            <div class="form-group">
                <label class="form-label">Interests (comma separated)</label>
                <input type="text" class="form-input" id="editInterests" placeholder="e.g., hiking, music, travel">
            </div>
            
            <button class="btn" id="saveProfileBtn" onclick="saveProfile()">
                <i class="fas fa-save"></i> Save Changes
            </button>
        </div>
    </div>

    <!-- Photo Upload Modal -->
    <div id="uploadPhotoModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Upload Photos</h3>
                <button class="close-modal" onclick="closeModal('uploadPhotoModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <p style="color: var(--gray-400); margin-bottom: 1.5rem;">
                You can upload up to 8 photos. Maximum file size: 5MB each.
            </p>
            
            <div class="form-group">
                <input type="file" id="photoInput" accept="image/*" multiple style="display: none;" onchange="previewPhotos()">
                <div style="border: 2px dashed rgba(255,255,255,0.2); border-radius: 8px; padding: 2rem; text-align: center; cursor: pointer;" 
                     onclick="document.getElementById('photoInput').click()">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--gray-400); margin-bottom: 1rem;"></i>
                    <p style="color: var(--light);">Click to select photos</p>
                    <p style="color: var(--gray-400); font-size: 0.9rem;">or drag and drop here</p>
                </div>
            </div>
            
            <div id="photoPreview" style="margin-top: 1rem; display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;"></div>
            
            <button class="btn" id="uploadPhotosBtn" onclick="uploadPhotos()" style="margin-top: 1.5rem;" disabled>
                <i class="fas fa-upload"></i> Upload Photos
            </button>
        </div>
    </div>

    <!-- Video Upload Modal -->
    <div id="uploadVideoModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Upload 90-Second Video</h3>
                <button class="close-modal" onclick="closeModal('uploadVideoModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <p style="color: var(--gray-400); margin-bottom: 1.5rem;">
                Upload a 90-second video profile. Maximum file size: 100MB
            </p>
            
            <div class="form-group">
                <input type="file" id="videoInput" accept="video/*" style="display: none;" onchange="previewVideo()">
                <div style="border: 2px dashed rgba(255,255,255,0.2); border-radius: 8px; padding: 2rem; text-align: center; cursor: pointer;" 
                     onclick="document.getElementById('videoInput').click()">
                    <i class="fas fa-video" style="font-size: 3rem; color: var(--gray-400); margin-bottom: 1rem;"></i>
                    <p style="color: var(--light);">Select a video file</p>
                    <p style="color: var(--gray-400); font-size: 0.9rem;">MP4, MOV, AVI up to 100MB</p>
                </div>
            </div>
            
            <div id="videoPreview" style="margin-top: 1rem;"></div>
            
            <button class="btn" id="uploadVideoBtn" onclick="uploadVideo()" style="margin-top: 1.5rem;" disabled>
                <i class="fas fa-upload"></i> Upload Video
            </button>
        </div>
    </div>

    <!-- Match Modal -->
    <div id="matchModal" class="modal-overlay">
        <div class="modal-content">
            <div class="match-heart"><i class="fas fa-heart"></i></div>
            <h2 style="margin-bottom: 0.5rem;">It's a Match! ðŸŽ‰</h2>
            <p style="color: var(--gray-400); margin-bottom: 1.5rem;">
                You and <span id="matchUserName" style="color: var(--primary); font-weight: 700;">Alex Johnson</span> liked each other!
            </p>
            
            <div style="background: rgba(255,255,255,0.05); border-radius: var(--radius); padding: 1.25rem; margin: 1.5rem 0; border: 1px solid rgba(37, 211, 102, 0.3);">
                <div style="color: var(--light); margin-bottom: 0.5rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <i class="fab fa-whatsapp" style="color: #25D366;"></i> WhatsApp Number:
                </div>
                <div id="matchUserPhone" style="font-size: 1.25rem; font-weight: 700; color: var(--primary); margin: 0.5rem 0;">+27 11 122 2333</div>
            </div>
            
            <button class="btn" onclick="openWhatsApp()" style="background: #25D366; margin-bottom: 0.75rem;">
                <i class="fab fa-whatsapp"></i> Open WhatsApp & Chat
            </button>
            <button class="btn btn-secondary" onclick="closeModal('matchModal')">Continue Matching</button>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Change Password</h3>
                <button class="close-modal" onclick="closeModal('changePasswordModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Current Password</label>
                <input type="password" class="form-input" id="currentPassword" placeholder="Enter current password">
                <div class="error-message" id="currentPasswordError"></div>
            </div>
            
            <div class="form-group">
                <label class="form-label">New Password</label>
                <input type="password" class="form-input" id="newPassword" placeholder="Enter new password" oninput="checkNewPasswordStrength()">
                <div class="password-strength">
                    <div class="strength-bar" id="newPasswordStrength"></div>
                </div>
                <div class="error-message" id="newPasswordError"></div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Confirm New Password</label>
                <input type="password" class="form-input" id="confirmPassword" placeholder="Confirm new password">
                <div class="error-message" id="confirmPasswordError"></div>
            </div>
            
            <button class="btn" id="changePasswordBtn" onclick="updatePassword()">
                <i class="fas fa-key"></i> Update Password
            </button>
        </div>
    </div>

    <!-- Terms Modal -->
    <div id="termsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 class="modal-title">Terms & Conditions</h3>
                <button class="close-modal" onclick="closeModal('termsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="color: var(--gray-400); line-height: 1.6; padding: 1rem 0;">
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">1. Acceptance of Terms</h4>
                <p>By accessing and using See U, you accept and agree to be bound by these Terms & Conditions.</p>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">2. Eligibility</h4>
                <p>You must be at least 18 years old to use See U. By using our service, you represent and warrant that you are 18 or older.</p>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">3. Mandatory Payment</h4>
                <p>Access to See U requires a mandatory annual subscription fee of R289.99. No free tier is available. All payments are processed through Yoco.</p>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">4. User Conduct</h4>
                <p>You agree not to:</p>
                <ul style="padding-left: 1.5rem; margin: 0.5rem 0;">
                    <li>Post false, inaccurate, or misleading information</li>
                    <li>Harass, abuse, or harm another person</li>
                    <li>Use the service for any illegal purpose</li>
                    <li>Share inappropriate or explicit content</li>
                    <li>Impersonate any person or entity</li>
                </ul>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">5. Payment and Refunds</h4>
                <p>All payments are processed through Yoco. Annual subscriptions are non-refundable once the service has been accessed. You may cancel auto-renewal at any time.</p>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">6. Privacy</h4>
                <p>Your privacy is important to us. Please review our Privacy Policy for information on how we collect and use your data.</p>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">7. Limitation of Liability</h4>
                <p>See U is not responsible for user interactions offline. Use caution when meeting people in person.</p>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">8. Changes to Terms</h4>
                <p>We may modify these terms at any time. Continued use of the service constitutes acceptance of modified terms.</p>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">9. Contact Information</h4>
                <p>For questions about these terms, contact us at: support@seeu.com</p>
            </div>
            
            <button class="btn" onclick="closeModal('termsModal')" style="margin-top: 1.5rem;">
                <i class="fas fa-check"></i> I Understand
            </button>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div id="privacyModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 class="modal-title">Privacy Policy</h3>
                <button class="close-modal" onclick="closeModal('privacyModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="color: var(--gray-400); line-height: 1.6; padding: 1rem 0;">
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">1. Information We Collect</h4>
                <p>We collect information you provide directly, including:</p>
                <ul style="padding-left: 1.5rem; margin: 0.5rem 0;">
                    <li>Name, email, phone number</li>
                    <li>Profile information (age, location, interests, bio)</li>
                    <li>Photos and videos you upload</li>
                    <li>Payment information processed through Yoco</li>
                    <li>Your interactions with other users</li>
                </ul>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">2. How We Use Your Information</h4>
                <p>We use your information to:</p>
                <ul style="padding-left: 1.5rem; margin: 0.5rem 0;">
                    <li>Provide and improve our dating services</li>
                    <li>Connect you with potential matches</li>
                    <li>Process payments for subscription</li>
                    <li>Communicate with you about your account</li>
                    <li>Ensure safety and security of our platform</li>
                </ul>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">3. Information Sharing</h4>
                <p>We share your information:</p>
                <ul style="padding-left: 1.5rem; margin: 0.5rem 0;">
                    <li>With other users as part of the matching process (profile information only)</li>
                    <li>With Yoco for payment processing</li>
                    <li>When required by law or to protect rights</li>
                    <li>With service providers who assist in operating our platform</li>
                </ul>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">4. Data Security</h4>
                <p>We implement security measures to protect your information, including encryption, secure servers, and access controls. However, no system is 100% secure.</p>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">5. Your Rights</h4>
                <p>You have the right to:</p>
                <ul style="padding-left: 1.5rem; margin: 0.5rem 0;">
                    <li>Access your personal information</li>
                    <li>Correct inaccurate information</li>
                    <li>Delete your account and data</li>
                    <li>Opt-out of marketing communications</li>
                    <li>Export your data</li>
                </ul>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">6. Cookies and Tracking</h4>
                <p>We use cookies to improve your experience, analyze usage, and remember your preferences.</p>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">7. Contact Us</h4>
                <p>For privacy-related questions, contact us at: privacy@seeu.com</p>
                
                <h4 style="color: var(--light); margin: 1.5rem 0 0.5rem 0;">8. Updates to Policy</h4>
                <p>We may update this policy periodically. We will notify you of significant changes.</p>
            </div>
            
            <button class="btn" onclick="closeModal('privacyModal')" style="margin-top: 1.5rem;">
                <i class="fas fa-check"></i> I Understand
            </button>
        </div>
    </div>

    <script>
        // ==================== CONFIGURATION ====================
        // FIXED: Added quotes around configuration values
        const SUPABASE_URL = "https://cuhmiqvzhcusxzelxxpg.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1aG1pcXZ6aGN1c3h6ZWx4eHBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxOTA4NTYsImV4cCI6MjA3OTc2Njg1Nn0.JMZ7fL-4A3XJEiZV4kp_TlZwwf_A6V42T_GgZHFs2W8";
        const YOCO_PUBLIC_KEY = "pk_live_87123875V4lebnV243d4";
        
        // FIXED: Correct Supabase client initialization
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Initialize Yoco SDK
        let yoco = null;
        let yocoCardElement = null;
        
        // ==================== APP STATE ====================
        let currentUser = null;
        let currentProfile = null;
        let authSession = null;
        let signupData = null;
        
        // Upload state
        let selectedPhotos = [];
        let selectedVideo = null;
        let currentPhotoIndex = 0;
        
        // Sample users for demo (in production, these come from Supabase)
        const sampleUsers = [
            {
                id: 1,
                full_name: "Sarah Johnson",
                age: 34,
                location: "Johannesburg",
                phone: "+27123456789",
                photos: [
                    "https://images.unsplash.com/photo-1494790108755-2616b612b786?w=400&h=600&fit=crop",
                    "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=400&h=600&fit=crop"
                ],
                video_url: "https://assets.mixkit.co/videos/preview/mixkit-woman-walking-her-dog-in-a-park-39856-large.mp4",
                bio: "Adventurous soul who loves hiking and photography. Looking for meaningful connections.",
                interests: ["Hiking", "Photography", "Travel", "Music", "Art"],
                business_info: {
                    name: "Sarah's Photography Studio",
                    description: "Professional portrait and landscape photography. Specializing in outdoor and adventure shoots.",
                    contact: "sarah@photography.com / +27123456789"
                },
                payment_status: "paid"
            },
            {
                id: 2,
                full_name: "David Smith",
                age: 32,
                location: "Cape Town",
                phone: "+27876543210",
                photos: [
                    "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=600&fit=crop",
                    "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=400&h=600&fit=crop"
                ],
                video_url: "https://assets.mixkit.co/videos/preview/mixkit-man-exercising-in-the-park-39858-large.mp4",
                bio: "Fitness enthusiast and entrepreneur. Love outdoor activities and trying new restaurants.",
                interests: ["Fitness", "Business", "Food", "Travel", "Sports"],
                business_info: {
                    name: "FitLife Personal Training",
                    description: "Certified personal trainer offering customized workout plans and nutrition guidance.",
                    contact: "david@fitlife.co.za / +27876543210"
                },
                payment_status: "paid"
            },
            {
                id: 3,
                full_name: "Amina Patel",
                age: 28,
                location: "Durban",
                phone: "+27711223344",
                photos: [
                    "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=400&h=600&fit=crop",
                    "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400&h=600&fit=crop"
                ],
                video_url: "https://assets.mixkit.co/videos/preview/mixkit-woman-reading-a-book-in-a-cafe-39860-large.mp4",
                bio: "Yoga instructor and wellness coach. Passionate about healthy living and mindfulness.",
                interests: ["Yoga", "Wellness", "Reading", "Cooking", "Nature"],
                business_info: {
                    name: "ZenYoga Studio",
                    description: "Offering yoga classes, meditation sessions, and wellness workshops for all levels.",
                    contact: "amina@zenyoga.co.za / +27711223344"
                },
                payment_status: "paid"
            }
        ];
        
        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('See U App Initializing...');
            console.log('Supabase URL:', SUPABASE_URL);
            console.log('Supabase Key exists:', !!SUPABASE_ANON_KEY);
            console.log('Supabase client:', supabase);
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize Yoco
            initializeYoco();
            
            // Check authentication status
            await checkAuthStatus();
            
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                }, 500);
            }, 1000);
        });
        
        // Setup event listeners
        function setupEventListeners() {
            // Enter key in forms
            document.getElementById('signupPassword')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') signUp();
            });
            
            document.getElementById('loginPassword')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') signIn();
            });
            
            // Bio character count
            document.getElementById('editBio')?.addEventListener('input', updateBioCharCount);
            document.getElementById('setupBio')?.addEventListener('input', updateSetupBioCharCount);
            
            // Drag and drop for photos
            setupDragAndDrop();
            
            // Form validation
            setupFormValidation();
        }
        
        // Initialize Yoco SDK
        function initializeYoco() {
            try {
                // FIXED: Correct Yoco SDK initialization
                yoco = new window.YocoSDK({
                    publicKey: YOCO_PUBLIC_KEY
                });
                
                // Create card element
                yocoCardElement = yoco.createCardElement({
                    element: '#yoco-card-element',
                    style: {
                        base: {
                            color: '#F8FAFC',
                            fontSize: '16px',
                            fontFamily: "'Inter', sans-serif",
                            '::placeholder': {
                                color: '#9CA3AF'
                            }
                        },
                        invalid: {
                            color: '#EF4444'
                        }
                    }
                });
                
                console.log('Yoco SDK initialized successfully');
            } catch (error) {
                console.error('Failed to initialize Yoco SDK:', error);
                showToast('Payment system initialization failed. Please refresh the page.', 'error');
            }
        }
        
        // Setup drag and drop
        function setupDragAndDrop() {
            const dropZone = document.querySelector('[onclick*="photoInput"]');
            if (dropZone) {
                dropZone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.borderColor = 'var(--primary)';
                    this.style.backgroundColor = 'rgba(255, 51, 102, 0.1)';
                });
                
                dropZone.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.style.borderColor = 'rgba(255,255,255,0.2)';
                    this.style.backgroundColor = 'transparent';
                });
                
                dropZone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.borderColor = 'rgba(255,255,255,0.2)';
                    this.style.backgroundColor = 'transparent';
                    
                    const files = e.dataTransfer.files;
                    const photoInput = document.getElementById('photoInput');
                    if (photoInput) {
                        photoInput.files = files;
                        previewPhotos();
                    }
                });
            }
        }
        
        // Setup form validation
        function setupFormValidation() {
            // Card holder name validation
            document.getElementById('cardName')?.addEventListener('input', function(e) {
                const value = e.target.value.trim();
                if (value && !/^[a-zA-Z\s]+$/.test(value)) {
                    showError('cardName', 'Cardholder name should only contain letters and spaces');
                } else {
                    clearError('cardName');
                }
            });
            
            // Age validation
            document.getElementById('setupAge')?.addEventListener('input', function(e) {
                const age = parseInt(e.target.value);
                if (age && (age < 18 || age > 100)) {
                    showError('setupAge', 'Age must be between 18 and 100');
                } else {
                    clearError('setupAge');
                }
            });
        }
        
        // ==================== AUTHENTICATION ====================
        
        // Check authentication status
        async function checkAuthStatus() {
            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) {
                    console.error('Auth session error:', error);
                    showScreen('signinScreen');
                    return;
                }
                
                if (session) {
                    authSession = session;
                    currentUser = session.user;
                    console.log('User authenticated:', currentUser.email);
                    
                    // Load user profile
                    await loadUserProfile();
                    
                    // Check if user has completed profile setup
                    if (currentProfile) {
                        if (currentProfile.payment_status === 'paid') {
                            if (!currentProfile.bio || !currentProfile.age) {
                                // Profile incomplete, show setup
                                showScreen('profileSetupScreen');
                            } else {
                                // Profile complete, show dashboard
                                showScreen('profilePage');
                                showToast('Welcome back!', 'success');
                            }
                        } else {
                            // User hasn't paid
                            signupData = {
                                name: currentProfile.full_name,
                                email: currentProfile.email,
                                phone: currentProfile.phone
                            };
                            showScreen('yocoPaymentScreen');
                            showToast('Please complete your payment to access See U', 'warning');
                        }
                    } else {
                        // No profile exists
                        console.log('No profile found for user');
                        showScreen('signinScreen');
                    }
                } else {
                    console.log('No active session, showing sign in screen');
                    showScreen('signinScreen');
                }
            } catch (error) {
                console.error('Auth check error:', error);
                showScreen('signinScreen');
            }
        }
        
        // Load user profile
        async function loadUserProfile() {
            try {
                if (!currentUser) return null;
                
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (error && error.code === 'PGRST116') {
                    // Profile doesn't exist yet
                    console.log('Profile does not exist yet');
                    return null;
                }
                
                if (error) throw error;
                
                currentProfile = profile;
                localStorage.setItem('seeu_profile', JSON.stringify(profile));
                console.log('Profile loaded:', profile);
                
                return profile;
            } catch (error) {
                console.error('Error loading profile:', error);
                return null;
            }
        }
        
        // Create user profile
        async function createUserProfile(userData, paymentStatus = 'pending') {
            try {
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .insert([{
                        id: currentUser.id,
                        email: currentUser.email,
                        full_name: userData.name,
                        phone: userData.phone,
                        payment_status: paymentStatus,
                        payment_date: paymentStatus === 'paid' ? new Date().toISOString() : null,
                        subscription_end: paymentStatus === 'paid' ? 
                            new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString() : null,
                        created_at: new Date().toISOString()
                    }])
                    .select()
                    .single();
                
                if (error) throw error;
                
                currentProfile = profile;
                localStorage.setItem('seeu_profile', JSON.stringify(profile));
                
                return profile;
            } catch (error) {
                console.error('Error creating profile:', error);
                throw error;
            }
        }
        
        // Sign In
        async function signIn() {
            clearErrors();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            // Validation
            if (!email) {
                showError('loginEmail', 'Email is required');
                return;
            }
            
            if (!validateEmail(email)) {
                showError('loginEmail', 'Please enter a valid email');
                return;
            }
            
            if (!password) {
                showError('loginPassword', 'Password is required');
                return;
            }
            
            setButtonLoading('loginBtn', true);
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                authSession = data.session;
                currentUser = data.user;
                
                // Load profile
                await loadUserProfile();
                
                if (!currentProfile) {
                    // This shouldn't happen, but handle it
                    showToast('Account setup incomplete. Please contact support.', 'error');
                    await supabase.auth.signOut();
                    showScreen('signinScreen');
                    return;
                }
                
                // Check payment status
                if (currentProfile.payment_status !== 'paid') {
                    signupData = {
                        name: currentProfile.full_name,
                        email: currentProfile.email,
                        phone: currentProfile.phone
                    };
                    showScreen('yocoPaymentScreen');
                    showToast('Please complete your payment to access See U', 'warning');
                } else {
                    // Check if profile is complete
                    if (!currentProfile.bio || !currentProfile.age) {
                        showScreen('profileSetupScreen');
                    } else {
                        showScreen('profilePage');
                    }
                    showToast('Welcome back!', 'success');
                }
                
            } catch (error) {
                console.error('Sign in error:', error);
                
                if (error.message.includes('Invalid login credentials')) {
                    showError('loginEmail', 'Invalid email or password');
                } else if (error.message.includes('Email not confirmed')) {
                    showError('loginEmail', 'Please verify your email address');
                } else {
                    showError('loginEmail', 'An error occurred. Please try again.');
                }
            } finally {
                setButtonLoading('loginBtn', false);
            }
        }
        
        // Sign Up
        async function signUp() {
            clearErrors();
            
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const phone = document.getElementById('signupPhone').value.trim();
            const password = document.getElementById('signupPassword').value;
            const termsAgreed = document.getElementById('termsAgreement').checked;
            
            // Validation
            if (!name) {
                showError('signupName', 'Name is required');
                return;
            }
            
            if (!email) {
                showError('signupEmail', 'Email is required');
                return;
            }
            
            if (!validateEmail(email)) {
                showError('signupEmail', 'Please enter a valid email');
                return;
            }
            
            if (!phone) {
                showError('signupPhone', 'Phone number is required');
                return;
            }
            
            if (!validatePhone(phone)) {
                showError('signupPhone', 'Please enter a valid South African phone number (e.g., +27123456789)');
                return;
            }
            
            if (!password) {
                showError('signupPassword', 'Password is required');
                return;
            }
            
            if (!validatePassword(password)) {
                showError('signupPassword', 'Password must be at least 8 characters with uppercase, lowercase, and a number');
                return;
            }
            
            if (!termsAgreed) {
                showError('terms', 'You must agree to the terms and conditions');
                return;
            }
            
            setButtonLoading('signupBtn', true);
            
            try {
                // Check if email exists
                const { data: existingUser, error: checkError } = await supabase
                    .from('profiles')
                    .select('id, payment_status')
                    .eq('email', email)
                    .maybeSingle();
                
                if (checkError && checkError.code !== 'PGRST116') {
                    throw checkError;
                }
                
                if (existingUser) {
                    if (existingUser.payment_status === 'paid') {
                        showError('signupEmail', 'An account with this email already exists. Please sign in.');
                        return;
                    } else {
                        showError('signupEmail', 'An account with this email already exists but payment is pending. Please sign in.');
                        return;
                    }
                }
                
                // Store signup data
                signupData = { name, email, phone, password };
                
                // Show payment screen
                showScreen('yocoPaymentScreen');
                
            } catch (error) {
                console.error('Sign up check error:', error);
                showError('signupEmail', 'An error occurred. Please try again.');
            } finally {
                setButtonLoading('signupBtn', false);
            }
        }
        
        // ==================== PAYMENT PROCESSING ====================
        
        // Process Yoco Payment
        async function processYocoPayment() {
            clearErrors();
            
            const cardName = document.getElementById('cardName').value.trim();
            
            // Validation
            if (!cardName) {
                showError('cardName', 'Cardholder name is required');
                return;
            }
            
            if (!signupData && (!currentUser || !currentProfile)) {
                showToast('Session expired. Please sign up again.', 'error');
                showScreen('signupScreen');
                return;
            }
            
            // Validate card
            if (!yocoCardElement) {
                showError('card', 'Payment system not initialized');
                return;
            }
            
            const cardState = yocoCardElement.getState();
            if (!cardState.valid) {
                showError('card', 'Please check your card details');
                return;
            }
            
            setButtonLoading('yocoPaymentBtn', true);
            
            try {
                // In production, you would:
                // 1. Create payment token with Yoco
                // 2. Send token to your backend
                // 3. Process payment on backend
                // 4. Create/update user on successful payment
                
                // For demo, simulate payment
                const paymentResult = await simulatePaymentProcessing();
                
                if (paymentResult.success) {
                    if (!currentUser) {
                        // New user signup
                        await createUserAccountAfterPayment();
                    } else {
                        // Existing user completing payment
                        await updatePaymentStatus(paymentResult.transactionId);
                    }
                    
                    showScreen('paymentSuccessScreen');
                } else {
                    throw new Error(paymentResult.message || 'Payment failed');
                }
                
            } catch (error) {
                console.error('Payment error:', error);
                
                if (error.message.includes('card_declined')) {
                    showError('card', 'Card was declined. Please try a different card.');
                } else if (error.message.includes('insufficient_funds')) {
                    showError('card', 'Insufficient funds. Please try a different card.');
                } else if (error.message.includes('expired_card')) {
                    showError('card', 'Card has expired. Please use a different card.');
                } else {
                    showError('card', 'Payment failed: ' + error.message);
                }
            } finally {
                setButtonLoading('yocoPaymentBtn', false);
            }
        }
        
        // Simulate payment processing
        async function simulatePaymentProcessing() {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    // Simulate 90% success rate for demo
                    if (Math.random() < 0.9) {
                        resolve({
                            success: true,
                            transactionId: 'txn_' + Date.now() + Math.random().toString(36).substr(2, 9),
                            amount: 28999,
                            currency: 'ZAR',
                            cardLastFour: '4242'
                        });
                    } else {
                        reject(new Error('Payment processing failed. Please try again.'));
                    }
                }, 2000);
            });
        }
        
        // Create user account after payment
        async function createUserAccountAfterPayment() {
            try {
                const { data: authData, error: authError } = await supabase.auth.signUp({
                    email: signupData.email,
                    password: signupData.password,
                    options: {
                        data: {
                            full_name: signupData.name,
                            phone: signupData.phone
                        }
                    }
                });
                
                if (authError) throw authError;
                
                currentUser = authData.user;
                authSession = authData.session;
                
                // Create profile with payment status
                await createUserProfile(signupData, 'paid');
                
                // Clear signup data
                signupData = null;
                
            } catch (error) {
                console.error('Create account error:', error);
                throw error;
            }
        }
        
        // Update payment status
        async function updatePaymentStatus(transactionId) {
            try {
                const { error } = await supabase
                    .from('profiles')
                    .update({
                        payment_status: 'paid',
                        payment_date: new Date().toISOString(),
                        subscription_end: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(),
                        yoco_transaction_id: transactionId,
                        payment_amount: 28999,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);
                
                if (error) throw error;
                
                // Update local profile
                currentProfile.payment_status = 'paid';
                currentProfile.payment_date = new Date().toISOString();
                currentProfile.subscription_end = new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString();
                
                localStorage.setItem('seeu_profile', JSON.stringify(currentProfile));
                
            } catch (error) {
                console.error('Update payment status error:', error);
                throw error;
            }
        }
        
        // Go back from payment
        function goBackFromPayment() {
            if (currentUser && currentProfile) {
                showScreen('signinScreen');
            } else {
                showScreen('signupScreen');
            }
        }
        
        // Complete onboarding
        function completeOnboarding() {
            showScreen('profileSetupScreen');
        }
        
        // ==================== PROFILE SETUP ====================
        
        // Complete profile setup
        async function completeProfileSetup() {
            const bio = document.getElementById('setupBio').value.trim();
            const age = parseInt(document.getElementById('setupAge').value);
            const location = document.getElementById('setupLocation').value.trim();
            const interests = document.getElementById('setupInterests').value
                .split(',')
                .map(i => i.trim())
                .filter(i => i.length > 0);
            
            // Validation
            if (!bio) {
                showToast('Please add a bio', 'error');
                return;
            }
            
            if (!age) {
                showToast('Please enter your age', 'error');
                return;
            }
            
            if (age < 18 || age > 100) {
                showToast('Age must be between 18 and 100', 'error');
                return;
            }
            
            setButtonLoading('completeSetupBtn', true);
            
            try {
                const { error } = await supabase
                    .from('profiles')
                    .update({
                        bio: bio,
                        age: age,
                        location: location,
                        interests: interests,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);
                
                if (error) throw error;
                
                // Update local profile
                currentProfile.bio = bio;
                currentProfile.age = age;
                currentProfile.location = location;
                currentProfile.interests = interests;
                
                localStorage.setItem('seeu_profile', JSON.stringify(currentProfile));
                
                showScreen('profilePage');
                showToast('Profile setup complete!', 'success');
                loadProfilePage();
                
            } catch (error) {
                console.error('Profile setup error:', error);
                showToast('Failed to save profile', 'error');
            } finally {
                setButtonLoading('completeSetupBtn', false);
            }
        }
        
        // Skip profile setup
        function skipProfileSetup() {
            showScreen('profilePage');
            showToast('You can complete your profile later', 'info');
        }
        
        // ==================== DASHBOARD PAGES ====================
        
        // Show screen
        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show requested screen
            const screen = document.getElementById(screenId);
            if (screen) {
                screen.classList.add('active');
                
                // Load content for specific screens
                if (screenId === 'profilePage') {
                    loadProfilePage();
                } else if (screenId === 'discoverPage') {
                    loadDiscoverPage();
                } else if (screenId === 'matchesPage') {
                    loadMatchesPage();
                } else if (screenId === 'settingsPage') {
                    loadSettingsPage();
                }
            }
            
            // Update navigation
            updateNav(screenId);
        }
        
        // Update navigation
        function updateNav(activePage) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeBtn = document.querySelector(`.nav-btn[onclick*="${activePage}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
        }
        
        // Load Profile Page
        async function loadProfilePage() {
            const container = document.getElementById('profileContent');
            
            if (!currentProfile) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-user"></i><h3>No Profile Found</h3></div>';
                return;
            }
            
            const interestsDisplay = currentProfile.interests 
                ? (Array.isArray(currentProfile.interests) ? currentProfile.interests.join(', ') : currentProfile.interests)
                : '';
            
            container.innerHTML = `
                <div class="profile-header">
                    <div class="profile-avatar" onclick="openModal('editProfileModal')">
                        ${currentProfile.photos && currentProfile.photos.length > 0 ? 
                            `<img src="${currentProfile.photos[0]}" alt="Profile">` :
                            `<i class="fas fa-user"></i>`
                        }
                    </div>
                    <div class="profile-info">
                        <h2>${escapeHtml(currentProfile.full_name || 'User')}</h2>
                        <p>${escapeHtml(currentProfile.email)}</p>
                        ${currentProfile.phone ? `<p>${escapeHtml(currentProfile.phone)}</p>` : ''}
                        ${currentProfile.bio ? `<p style="color: var(--gray-300); margin: 0.5rem 0;">${escapeHtml(currentProfile.bio)}</p>` : ''}
                        ${currentProfile.age ? `<p style="color: var(--gray-400);">${currentProfile.age} years â€¢ ${escapeHtml(currentProfile.location || '')}</p>` : ''}
                        <div class="premium-badge">
                            <i class="fas fa-crown"></i> Premium Member
                        </div>
                        ${interestsDisplay ? `<div style="margin-top: 0.5rem;"><strong>Interests:</strong> ${escapeHtml(interestsDisplay)}</div>` : ''}
                        <button class="edit-profile-btn" onclick="openModal('editProfileModal')">
                            <i class="fas fa-edit"></i> Edit Profile
                        </button>
                    </div>
                </div>
                
                <!-- Photos Section -->
                <div class="media-section">
                    <div class="section-title">
                        <span>Photos (${currentProfile.photos ? currentProfile.photos.length : 0}/8)</span>
                        <button class="add-media-btn" onclick="openModal('uploadPhotoModal')">
                            <i class="fas fa-plus"></i> Add Photos
                        </button>
                    </div>
                    <div class="media-grid" id="photosGrid">
                        ${renderPhotos()}
                    </div>
                </div>
                
                <!-- Video Section -->
                <div class="media-section">
                    <div class="section-title">
                        <span>90-Second Video Profile</span>
                        <button class="add-media-btn" onclick="openModal('uploadVideoModal')">
                            <i class="fas fa-plus"></i> ${currentProfile.video_url ? 'Change Video' : 'Add Video'}
                        </button>
                    </div>
                    <div class="media-grid">
                        <div class="media-item" id="videoContainer" onclick="openModal('uploadVideoModal')">
                            ${currentProfile.video_url ? 
                                `<video src="${currentProfile.video_url}" style="width: 100%; height: 100%; object-fit: cover;"></video>
                                 <button class="remove-btn" onclick="removeVideo(event)">
                                     <i class="fas fa-times"></i>
                                 </button>` :
                                `<i class="fas fa-video"></i>
                                 <span>Add 90-second video</span>`
                            }
                        </div>
                    </div>
                </div>
                
                <!-- Business/Service Feature -->
                <div class="business-section">
                    <div class="business-toggle">
                        <div>
                            <h3 style="color: var(--light); margin-bottom: 0.25rem;">Business/Service Feature</h3>
                            <p style="color: var(--gray-400); font-size: 0.9rem;">
                                Showcase your business or services on your profile
                            </p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="businessToggle" ${currentProfile.business_info ? 'checked' : ''} onchange="toggleBusinessFeature()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="business-form" id="businessForm" style="${currentProfile.business_info ? 'display: block;' : 'display: none;'}">
                        <div class="form-group">
                            <label class="form-label">Business/Service Name</label>
                            <input type="text" class="form-input" id="businessName" value="${currentProfile.business_info?.name || ''}" placeholder="Enter business name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-textarea" id="businessDescription" placeholder="Describe your business or service">${currentProfile.business_info?.description || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contact Email/Phone</label>
                            <input type="text" class="form-input" id="businessContact" value="${currentProfile.business_info?.contact || ''}" placeholder="Contact details">
                        </div>
                        <button class="btn" onclick="saveBusinessInfo()">
                            <i class="fas fa-save"></i> Save Business Info
                        </button>
                    </div>
                </div>
                
                <!-- Display Business Info if exists -->
                ${currentProfile.business_info ? `
                    <div class="business-card">
                        <h4>${escapeHtml(currentProfile.business_info.name)}</h4>
                        <p>${escapeHtml(currentProfile.business_info.description)}</p>
                        <div class="business-contact">
                            <i class="fas fa-envelope"></i>
                            <span>${escapeHtml(currentProfile.business_info.contact)}</span>
                        </div>
                        <p style="color: var(--gray-400); font-size: 0.8rem; margin-top: 0.5rem;">
                            <i class="fas fa-info-circle"></i> This business info is visible to other users on your profile
                        </p>
                    </div>
                ` : ''}
            `;
        }
        
        // Render photos
        function renderPhotos() {
            let html = '';
            const photos = currentProfile.photos || [];
            
            // Existing photos
            photos.forEach((photo, index) => {
                html += `
                    <div class="media-item">
                        <img src="${photo}" alt="Photo ${index + 1}">
                        <button class="remove-btn" onclick="removePhoto(${index})">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            });
            
            // Empty slots
            const emptySlots = 8 - photos.length;
            for (let i = 0; i < emptySlots; i++) {
                html += `
                    <div class="media-item" onclick="openModal('uploadPhotoModal')">
                        <i class="fas fa-plus"></i>
                        <span>Add Photo</span>
                    </div>
                `;
            }
            
            return html;
        }
        
        // Load Discover Page
        async function loadDiscoverPage() {
            const container = document.getElementById('discoverContent');
            
            // Filter sample users (in production, fetch from Supabase)
            const availableUsers = sampleUsers.filter(user => user.id !== currentProfile?.id);
            
            if (availableUsers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>No Users Available</h3>
                        <p>Check back later for new profiles</p>
                    </div>
                `;
                return;
            }
            
            // Get random user
            const user = availableUsers[Math.floor(Math.random() * availableUsers.length)];
            currentPhotoIndex = 0;
            
            container.innerHTML = `
                <div class="user-card">
                    <div class="user-photos">
                        ${user.photos.map((photo, index) => `
                            <img src="${photo}" class="user-photo ${index === 0 ? 'active' : ''}" alt="Photo ${index + 1}">
                        `).join('')}
                        
                        ${user.photos.length > 1 ? `
                            <div class="photo-nav">
                                <div class="nav-btn prev-btn" onclick="prevPhoto()">
                                    <i class="fas fa-chevron-left"></i>
                                </div>
                                <div class="nav-btn next-btn" onclick="nextPhoto()">
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                            </div>
                            
                            <div class="photo-dots">
                                ${user.photos.map((_, index) => `
                                    <div class="dot ${index === 0 ? 'active' : ''}" onclick="goToPhoto(${index})"></div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="user-info">
                        <div class="user-name">${escapeHtml(user.full_name)}, ${user.age}</div>
                        <div class="user-age">${escapeHtml(user.location)}</div>
                        
                        <div class="user-bio">${escapeHtml(user.bio)}</div>
                        
                        ${user.interests && user.interests.length > 0 ? `
                            <div class="interests">
                                ${user.interests.map(interest => `
                                    <div class="interest-tag">${escapeHtml(interest)}</div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        ${user.business_info ? `
                            <div class="business-card">
                                <h4>${escapeHtml(user.business_info.name)}</h4>
                                <p>${escapeHtml(user.business_info.description)}</p>
                                <div class="business-contact">
                                    <i class="fas fa-envelope"></i>
                                    <span>${escapeHtml(user.business_info.contact)}</span>
                                </div>
                            </div>
                        ` : ''}
                        
                        ${user.video_url ? `
                            <div class="video-player">
                                <video controls>
                                    <source src="${user.video_url}" type="video/mp4">
                                </video>
                            </div>
                        ` : ''}
                        
                        <div class="action-buttons">
                            <button class="btn like-btn" onclick="likeUser(${user.id}, '${escapeHtml(user.full_name)}')">
                                <i class="fas fa-heart"></i> Like
                            </button>
                            <button class="btn whatsapp-btn" onclick="openWhatsAppDirect('${escapeHtml(user.full_name)}', '${user.phone}')">
                                <i class="fab fa-whatsapp"></i> Connect
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Load Matches Page
        async function loadMatchesPage() {
            const container = document.getElementById('matchesList');
            
            // For demo, use sample users as matches
            // In production, fetch actual matches from Supabase
            const matches = sampleUsers.slice(0, 2); // First 2 as demo matches
            
            if (matches.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-heart-broken"></i>
                        <h3>No Matches Yet</h3>
                        <p>Start discovering people to get matches!</p>
                        <button class="btn" onclick="showScreen('discoverPage')" style="margin-top: 1rem;">
                            <i class="fas fa-search"></i> Discover People
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            matches.forEach(user => {
                html += `
                    <div class="match-card">
                        <img src="${user.photos[0]}" class="match-photo" alt="${escapeHtml(user.full_name)}">
                        <div style="font-weight: bold; color: var(--light);">${escapeHtml(user.full_name)}</div>
                        <div style="color: var(--gray-400); font-size: 0.875rem;">${user.age}</div>
                        ${user.business_info ? `
                            <div style="color: var(--primary); font-size: 0.75rem; margin: 0.25rem 0;">
                                <i class="fas fa-briefcase"></i> ${escapeHtml(user.business_info.name)}
                            </div>
                        ` : ''}
                        <button class="btn" onclick="openWhatsAppDirect('${escapeHtml(user.full_name)}', '${user.phone}')" style="margin-top: 0.75rem; padding: 0.5rem; font-size: 0.875rem;">
                            <i class="fab fa-whatsapp"></i> Connect
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Load Settings Page
        async function loadSettingsPage() {
            if (!currentProfile) return;
            
            // Update form fields
            document.getElementById('settingsEmail').value = currentProfile.email || '';
            document.getElementById('settingsPhone').value = currentProfile.phone || '';
            
            // Update subscription info
            if (currentProfile.subscription_end) {
                const endDate = new Date(currentProfile.subscription_end);
                document.getElementById('subscriptionRenewal').textContent = endDate.toLocaleDateString();
            }
        }
        
        // ==================== PROFILE MANAGEMENT ====================
        
        // Open modal
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            
            if (modalId === 'editProfileModal' && currentProfile) {
                document.getElementById('editName').value = currentProfile.full_name || '';
                document.getElementById('editBio').value = currentProfile.bio || '';
                document.getElementById('editAge').value = currentProfile.age || '';
                document.getElementById('editLocation').value = currentProfile.location || '';
                document.getElementById('editInterests').value = currentProfile.interests 
                    ? (Array.isArray(currentProfile.interests) ? currentProfile.interests.join(', ') : currentProfile.interests)
                    : '';
                
                updateBioCharCount();
            }
        }
        
        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            
            // Clear upload previews
            if (modalId === 'uploadPhotoModal') {
                document.getElementById('photoPreview').innerHTML = '';
                document.getElementById('photoInput').value = '';
                selectedPhotos = [];
                const uploadBtn = document.getElementById('uploadPhotosBtn');
                if (uploadBtn) {
                    uploadBtn.disabled = true;
                    uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Photos';
                }
            }
            
            if (modalId === 'uploadVideoModal') {
                document.getElementById('videoPreview').innerHTML = '';
                document.getElementById('videoInput').value = '';
                selectedVideo = null;
                const uploadBtn = document.getElementById('uploadVideoBtn');
                if (uploadBtn) {
                    uploadBtn.disabled = true;
                    uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Video';
                }
            }
        }
        
        // Save Profile
        async function saveProfile() {
            const name = document.getElementById('editName').value.trim();
            const bio = document.getElementById('editBio').value.trim();
            const age = parseInt(document.getElementById('editAge').value);
            const location = document.getElementById('editLocation').value.trim();
            const interests = document.getElementById('editInterests').value
                .split(',')
                .map(i => i.trim())
                .filter(i => i.length > 0);
            
            // Validation
            if (!name) {
                showToast('Name is required', 'error');
                return;
            }
            
            if (age && (age < 18 || age > 100)) {
                showToast('Age must be between 18 and 100', 'error');
                return;
            }
            
            setButtonLoading('saveProfileBtn', true);
            
            try {
                const { error } = await supabase
                    .from('profiles')
                    .update({
                        full_name: name,
                        bio: bio,
                        age: age || null,
                        location: location,
                        interests: interests,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);
                
                if (error) throw error;
                
                // Update local profile
                currentProfile.full_name = name;
                currentProfile.bio = bio;
                currentProfile.age = age || null;
                currentProfile.location = location;
                currentProfile.interests = interests;
                
                localStorage.setItem('seeu_profile', JSON.stringify(currentProfile));
                
                closeModal('editProfileModal');
                showToast('Profile updated successfully', 'success');
                loadProfilePage();
                
            } catch (error) {
                console.error('Save profile error:', error);
                showToast('Failed to update profile', 'error');
            } finally {
                setButtonLoading('saveProfileBtn', false);
            }
        }
        
        // Toggle Business Feature
        function toggleBusinessFeature() {
            const toggle = document.getElementById('businessToggle');
            const form = document.getElementById('businessForm');
            
            if (toggle.checked) {
                form.style.display = 'block';
                if (currentProfile.business_info) {
                    document.getElementById('businessName').value = currentProfile.business_info.name || '';
                    document.getElementById('businessDescription').value = currentProfile.business_info.description || '';
                    document.getElementById('businessContact').value = currentProfile.business_info.contact || '';
                }
            } else {
                form.style.display = 'none';
            }
        }
        
        // Save Business Info
        async function saveBusinessInfo() {
            const name = document.getElementById('businessName').value.trim();
            const description = document.getElementById('businessDescription').value.trim();
            const contact = document.getElementById('businessContact').value.trim();
            
            if (!name || !description || !contact) {
                showToast('Please fill in all business information fields', 'error');
                return;
            }
            
            try {
                const businessInfo = {
                    name: name,
                    description: description,
                    contact: contact
                };
                
                const { error } = await supabase
                    .from('profiles')
                    .update({
                        business_info: businessInfo,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);
                
                if (error) throw error;
                
                currentProfile.business_info = businessInfo;
                localStorage.setItem('seeu_profile', JSON.stringify(currentProfile));
                
                showToast('Business information saved!', 'success');
                loadProfilePage();
                
            } catch (error) {
                console.error('Save business info error:', error);
                showToast('Failed to save business information', 'error');
            }
        }
        
        // ==================== MEDIA UPLOAD ====================
        
        // Preview photos
        function previewPhotos() {
            const input = document.getElementById('photoInput');
            const preview = document.getElementById('photoPreview');
            const uploadBtn = document.getElementById('uploadPhotosBtn');
            
            if (!input.files.length) {
                preview.innerHTML = '';
                uploadBtn.disabled = true;
                return;
            }
            
            preview.innerHTML = '';
            selectedPhotos = [];
            
            const files = Array.from(input.files).slice(0, 8);
            
            files.forEach((file, index) => {
                if (!file.type.startsWith('image/')) {
                    showToast(`File ${file.name} is not an image`, 'error');
                    return;
                }
                
                if (file.size > 5 * 1024 * 1024) {
                    showToast(`Image ${file.name} is too large (max 5MB)`, 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.width = '100%';
                    img.style.height = '100px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '4px';
                    
                    const container = document.createElement('div');
                    container.style.position = 'relative';
                    container.appendChild(img);
                    
                    preview.appendChild(container);
                    
                    selectedPhotos.push({
                        file: file,
                        dataUrl: e.target.result
                    });
                    
                    if (index === files.length - 1) {
                        uploadBtn.disabled = false;
                    }
                };
                reader.readAsDataURL(file);
            });
        }
        
        // Preview video
        function previewVideo() {
            const input = document.getElementById('videoInput');
            const preview = document.getElementById('videoPreview');
            const uploadBtn = document.getElementById('uploadVideoBtn');
            
            if (!input.files.length) {
                preview.innerHTML = '';
                uploadBtn.disabled = true;
                return;
            }
            
            const file = input.files[0];
            
            if (!file.type.startsWith('video/')) {
                showToast('Please select a video file', 'error');
                return;
            }
            
            if (file.size > 100 * 1024 * 1024) {
                showToast('Video file is too large (max 100MB)', 'error');
                return;
            }
            
            selectedVideo = file;
            
            const video = document.createElement('video');
            video.src = URL.createObjectURL(file);
            video.controls = true;
            video.style.width = '100%';
            video.style.borderRadius = '8px';
            
            preview.innerHTML = '';
            preview.appendChild(video);
            uploadBtn.disabled = false;
        }
        
        // Upload photos
        async function uploadPhotos() {
            if (!selectedPhotos.length) {
                showToast('Please select photos to upload', 'error');
                return;
            }
            
            const uploadBtn = document.getElementById('uploadPhotosBtn');
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
            
            try {
                // Simulate upload (in production, upload to Supabase Storage)
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Add sample photos for demo
                const existingPhotos = currentProfile.photos || [];
                const newPhotos = [
                    'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=400&fit=crop',
                    'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=400&h=400&fit=crop'
                ].slice(0, Math.min(2, 8 - existingPhotos.length));
                
                const updatedPhotos = [...existingPhotos, ...newPhotos];
                
                // Update profile
                const { error: updateError } = await supabase
                    .from('profiles')
                    .update({
                        photos: updatedPhotos,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);
                
                if (updateError) throw updateError;
                
                // Update local profile
                currentProfile.photos = updatedPhotos;
                localStorage.setItem('seeu_profile', JSON.stringify(currentProfile));
                
                closeModal('uploadPhotoModal');
                showToast(`${newPhotos.length} photos uploaded successfully`, 'success');
                loadProfilePage();
                
            } catch (error) {
                console.error('Upload error:', error);
                showToast('Upload failed. Please try again.', 'error');
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Photos';
            }
        }
        
        // Remove photo
        async function removePhoto(index) {
            if (!confirm('Remove this photo?')) return;
            
            try {
                const updatedPhotos = [...currentProfile.photos];
                updatedPhotos.splice(index, 1);
                
                const { error: updateError } = await supabase
                    .from('profiles')
                    .update({
                        photos: updatedPhotos,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);
                
                if (updateError) throw updateError;
                
                currentProfile.photos = updatedPhotos;
                localStorage.setItem('seeu_profile', JSON.stringify(currentProfile));
                
                showToast('Photo removed', 'success');
                loadProfilePage();
                
            } catch (error) {
                console.error('Remove photo error:', error);
                showToast('Failed to remove photo', 'error');
            }
        }
        
        // Upload video
        async function uploadVideo() {
            if (!selectedVideo) {
                showToast('Please select a video to upload', 'error');
                return;
            }
            
            const uploadBtn = document.getElementById('uploadVideoBtn');
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
            
            try {
                // Simulate upload (in production, upload to Supabase Storage)
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // Use demo video URL
                const videoUrl = 'https://assets.mixkit.co/videos/preview/mixkit-man-exercising-in-the-park-39858-large.mp4';
                
                const { error: updateError } = await supabase
                    .from('profiles')
                    .update({
                        video_url: videoUrl,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);
                
                if (updateError) throw updateError;
                
                currentProfile.video_url = videoUrl;
                localStorage.setItem('seeu_profile', JSON.stringify(currentProfile));
                
                closeModal('uploadVideoModal');
                showToast('Video uploaded successfully', 'success');
                loadProfilePage();
                
            } catch (error) {
                console.error('Video upload error:', error);
                showToast('Video upload failed. Please try again.', 'error');
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Video';
            }
        }
        
        // Remove video
        async function removeVideo(event) {
            event.stopPropagation();
            
            if (!confirm('Remove video?')) return;
            
            try {
                const { error: updateError } = await supabase
                    .from('profiles')
                    .update({
                        video_url: null,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);
                
                if (updateError) throw updateError;
                
                currentProfile.video_url = null;
                localStorage.setItem('seeu_profile', JSON.stringify(currentProfile));
                
                showToast('Video removed', 'success');
                loadProfilePage();
                
            } catch (error) {
                console.error('Remove video error:', error);
                showToast('Failed to remove video', 'error');
            }
        }
        
        // ==================== USER INTERACTIONS ====================
        
        // Like user
        async function likeUser(userId, userName) {
            try {
                showToast(`You liked ${userName}!`, 'success');
                
                // Simulate match (30% chance)
                if (Math.random() < 0.3) {
                    const user = sampleUsers.find(u => u.id === userId);
                    if (user) {
                        document.getElementById('matchUserName').textContent = user.full_name;
                        document.getElementById('matchUserPhone').textContent = user.phone;
                        openModal('matchModal');
                    }
                }
                
            } catch (error) {
                console.error('Like user error:', error);
                showToast('Failed to like user', 'error');
            }
        }
        
        // Open WhatsApp
        function openWhatsApp() {
            const phone = document.getElementById('matchUserPhone').textContent;
            const name = document.getElementById('matchUserName').textContent;
            
            openWhatsAppDirect(name, phone);
            closeModal('matchModal');
        }
        
        // Open WhatsApp direct
        function openWhatsAppDirect(name, phone) {
            if (!phone) {
                showToast('No WhatsApp number available for this user', 'error');
                return;
            }
            
            const cleanPhone = phone.replace(/[^\d+]/g, '');
            const message = `Hi ${name}! ðŸ‘‹ I saw your profile on See U. Let's chat!`;
            const whatsappUrl = `https://wa.me/${cleanPhone}?text=${encodeURIComponent(message)}`;
            
            window.open(whatsappUrl, '_blank');
        }
        
        // Photo navigation
        function prevPhoto() {
            const photos = document.querySelectorAll('.user-photo');
            const dots = document.querySelectorAll('.dot');
            
            if (photos.length <= 1) return;
            
            currentPhotoIndex--;
            if (currentPhotoIndex < 0) {
                currentPhotoIndex = photos.length - 1;
            }
            
            photos.forEach((photo, index) => {
                photo.classList.toggle('active', index === currentPhotoIndex);
            });
            
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentPhotoIndex);
            });
        }
        
        function nextPhoto() {
            const photos = document.querySelectorAll('.user-photo');
            const dots = document.querySelectorAll('.dot');
            
            if (photos.length <= 1) return;
            
            currentPhotoIndex++;
            if (currentPhotoIndex >= photos.length) {
                currentPhotoIndex = 0;
            }
            
            photos.forEach((photo, index) => {
                photo.classList.toggle('active', index === currentPhotoIndex);
            });
            
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentPhotoIndex);
            });
        }
        
        function goToPhoto(index) {
            const photos = document.querySelectorAll('.user-photo');
            const dots = document.querySelectorAll('.dot');
            
            currentPhotoIndex = index;
            
            photos.forEach((photo, i) => {
                photo.classList.toggle('active', i === index);
            });
            
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
        }
        
        // ==================== SETTINGS ====================
        
        // Change password
        function changePassword() {
            openModal('changePasswordModal');
        }
        
        // Update password
        async function updatePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validation
            if (!currentPassword) {
                showError('currentPassword', 'Current password is required');
                return;
            }
            
            if (!newPassword) {
                showError('newPassword', 'New password is required');
                return;
            }
            
            if (!validatePassword(newPassword)) {
                showError('newPassword', 'Password must be at least 8 characters with uppercase, lowercase, and a number');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showError('confirmPassword', 'Passwords do not match');
                return;
            }
            
            setButtonLoading('changePasswordBtn', true);
            
            try {
                // Update password in Supabase
                const { error } = await supabase.auth.updateUser({
                    password: newPassword
                });
                
                if (error) throw error;
                
                closeModal('changePasswordModal');
                showToast('Password updated successfully', 'success');
                
                // Clear form
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                
            } catch (error) {
                console.error('Update password error:', error);
                showToast('Failed to update password', 'error');
            } finally {
                setButtonLoading('changePasswordBtn', false);
            }
        }
        
        // Show terms modal
        function showTermsModal() {
            openModal('termsModal');
        }
        
        // Show privacy modal
        function showPrivacyModal() {
            openModal('privacyModal');
        }
        
        // ==================== UTILITY FUNCTIONS ====================
        
        // Show toast
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.id = toastId;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 400);
            }, 5000);
        }
        
        // Validate email
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // Validate phone
        function validatePhone(phone) {
            const cleanPhone = phone.replace(/\s/g, '');
            const re = /^\+27[0-9]{9}$/;
            return re.test(cleanPhone);
        }
        
        // Validate password
        function validatePassword(password) {
            const re = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/;
            return re.test(password);
        }
        
        // Check password strength
        function checkPasswordStrength() {
            const password = document.getElementById('signupPassword').value;
            const strengthBar = document.getElementById('passwordStrength');
            
            let strength = 0;
            if (password.length >= 8) strength += 25;
            if (/[A-Z]/.test(password)) strength += 25;
            if (/[0-9]/.test(password)) strength += 25;
            if (/[^A-Za-z0-9]/.test(password)) strength += 25;
            
            strengthBar.style.width = strength + '%';
            
            if (strength < 50) {
                strengthBar.className = 'strength-bar strength-weak';
            } else if (strength < 75) {
                strengthBar.className = 'strength-bar strength-medium';
            } else {
                strengthBar.className = 'strength-bar strength-strong';
            }
        }
        
        // Check new password strength
        function checkNewPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthBar = document.getElementById('newPasswordStrength');
            
            let strength = 0;
            if (password.length >= 8) strength += 25;
            if (/[A-Z]/.test(password)) strength += 25;
            if (/[0-9]/.test(password)) strength += 25;
            if (/[^A-Za-z0-9]/.test(password)) strength += 25;
            
            strengthBar.style.width = strength + '%';
            
            if (strength < 50) {
                strengthBar.className = 'strength-bar strength-weak';
            } else if (strength < 75) {
                strengthBar.className = 'strength-bar strength-medium';
            } else {
                strengthBar.className = 'strength-bar strength-strong';
            }
        }
        
        // Update bio char count
        function updateBioCharCount() {
            const bio = document.getElementById('editBio').value;
            const maxLength = 500;
            const currentLength = bio.length;
            document.getElementById('bioCharCount').textContent = maxLength - currentLength;
        }
        
        // Update setup bio char count
        function updateSetupBioCharCount() {
            const bio = document.getElementById('setupBio').value;
            const maxLength = 500;
            const currentLength = bio.length;
            document.getElementById('setupBioCharCount').textContent = maxLength - currentLength;
        }
        
        // Show error
        function showError(inputId, message) {
            const errorElement = document.getElementById(inputId + 'Error');
            const inputElement = document.getElementById(inputId);
            
            if (errorElement && inputElement) {
                errorElement.textContent = message;
                errorElement.classList.add('show');
                inputElement.classList.add('error');
                
                if (inputId === 'card') {
                    const cardElement = document.getElementById('yoco-card-element');
                    if (cardElement) {
                        cardElement.classList.add('error');
                    }
                }
            }
        }
        
        // Clear error
        function clearError(inputId) {
            const errorElement = document.getElementById(inputId + 'Error');
            const inputElement = document.getElementById(inputId);
            
            if (errorElement && inputElement) {
                errorElement.classList.remove('show');
                inputElement.classList.remove('error');
                
                if (inputId === 'card') {
                    const cardElement = document.getElementById('yoco-card-element');
                    if (cardElement) {
                        cardElement.classList.remove('error');
                    }
                }
            }
        }
        
        // Clear all errors
        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(el => {
                el.classList.remove('show');
            });
            document.querySelectorAll('.form-input').forEach(el => {
                el.classList.remove('error');
            });
            
            const cardElement = document.getElementById('yoco-card-element');
            if (cardElement) {
                cardElement.classList.remove('error');
            }
        }
        
        // Set button loading
        function setButtonLoading(buttonId, isLoading) {
            const button = document.getElementById(buttonId);
            if (!button) return;
            
            if (isLoading) {
                button.classList.add('btn-loading');
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            } else {
                button.classList.remove('btn-loading');
                button.disabled = false;
                
                // Reset button text
                const buttons = {
                    'loginBtn': '<i class="fas fa-sign-in-alt"></i> Sign In',
                    'signupBtn': '<i class="fas fa-arrow-right"></i> Continue to Payment (R289.99)',
                    'yocoPaymentBtn': '<i class="fas fa-lock"></i> Pay R289.99 Now',
                    'saveProfileBtn': '<i class="fas fa-save"></i> Save Changes',
                    'completeSetupBtn': '<i class="fas fa-check"></i> Complete Setup & Continue',
                    'changePasswordBtn': '<i class="fas fa-key"></i> Update Password'
                };
                
                if (buttons[buttonId]) {
                    button.innerHTML = buttons[buttonId];
                }
            }
        }
        
        // Escape HTML
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Logout
        async function logout() {
            if (!confirm('Are you sure you want to logout?')) return;
            
            try {
                const { error } = await supabase.auth.signOut();
                
                if (error) throw error;
                
                // Clear state
                currentUser = null;
                currentProfile = null;
                authSession = null;
                signupData = null;
                localStorage.removeItem('seeu_profile');
                
                showToast('Logged out successfully', 'success');
                setTimeout(() => {
                    showScreen('signinScreen');
                }, 1000);
                
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Logout failed. Please try again.', 'error');
            }
        }
        
        // ==================== EXPORT FUNCTIONS ====================
        window.showScreen = showScreen;
        window.signIn = signIn;
        window.signUp = signUp;
        window.processYocoPayment = processYocoPayment;
        window.goBackFromPayment = goBackFromPayment;
        window.completeOnboarding = completeOnboarding;
        window.completeProfileSetup = completeProfileSetup;
        window.skipProfileSetup = skipProfileSetup;
        window.logout = logout;
        window.openModal = openModal;
        window.closeModal = closeModal;
        window.saveProfile = saveProfile;
        window.previewPhotos = previewPhotos;
        window.previewVideo = previewVideo;
        window.uploadPhotos = uploadPhotos;
        window.removePhoto = removePhoto;
        window.uploadVideo = uploadVideo;
        window.removeVideo = removeVideo;
        window.toggleBusinessFeature = toggleBusinessFeature;
        window.saveBusinessInfo = saveBusinessInfo;
        window.likeUser = likeUser;
        window.prevPhoto = prevPhoto;
        window.nextPhoto = nextPhoto;
        window.goToPhoto = goToPhoto;
        window.openWhatsApp = openWhatsApp;
        window.openWhatsAppDirect = openWhatsAppDirect;
        window.changePassword = changePassword;
        window.updatePassword = updatePassword;
        window.showTermsModal = showTermsModal;
        window.showPrivacyModal = showPrivacyModal;
        window.checkPasswordStrength = checkPasswordStrength;
        window.checkNewPasswordStrength = checkNewPasswordStrength;
        
        console.log('See U Production App Ready!');
    </script>
</body>
</html>